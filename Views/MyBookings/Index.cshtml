@model List<ASAPGetaway.Models.Booking>

<style>
    .bookings-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .bookings-header { text-align: center; margin-bottom: 30px; color: #333; }
    .bookings-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin-bottom: 40px; }
    
    .booking-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s; display: flex; flex-direction: column; position: relative; border-left: 5px solid #28a745; }
    .booking-card.cancelled { border-left-color: #dc3545; opacity: 0.7; }
    .booking-card.pending { border-left-color: #ffc107; }
    .booking-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.2); }
    
    .booking-image { width: 100%; height: 200px; object-fit: cover; display: block; }
    .booking-image-placeholder { width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 60px; color: white; }
    
    .booking-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
    
    .status-badge { position: absolute; top: 15px; right: 15px; padding: 8px 15px; border-radius: 20px; font-weight: 700; font-size: 13px; z-index: 10; color: white; }
    .status-booked { background: #28a745; }
    .status-pending { background: #ffc107; color: #333; }
    .status-cancelled { background: #dc3545; }
    
    .booking-title { font-size: 22px; font-weight: 700; color: #333; margin-bottom: 5px; }
    .booking-id { font-size: 13px; color: #999; margin-bottom: 15px; }
    
    .booking-info { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; }
    .booking-info-row { display: flex; justify-content: space-between; align-items: center; }
    .booking-info-label { color: #666; font-weight: 500; }
    .booking-info-value { color: #333; font-weight: 600; }
    
    .booking-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: auto; }
    
    .btn-booking { position: relative; width: 100%; height: 50px; padding: 0; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; font-size: 22px; text-decoration: none; background: white; color: #666; }
    .btn-booking::after { content: attr(data-tooltip); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%) translateY(-8px); background: rgba(0, 0, 0, 0.85); color: white; padding: 6px 12px; border-radius: 6px; font-size: 13px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 1000; }
    .btn-booking:hover::after { opacity: 1; transform: translateX(-50%) translateY(-4px); }
    .btn-booking:hover { background: #f5f5f5; border-color: #999; transform: scale(1.03); }
    .btn-booking:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-booking:disabled:hover { transform: none; background: white; }
    
    .alert-pending { background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: 600; border: 1px solid #ffeaa7; }
    
    .no-bookings { text-align: center; padding: 60px 20px; color: #999; font-size: 18px; }
    
    @@media (max-width: 768px) { .bookings-grid { grid-template-columns: 1fr; } }
</style>

<div class="bookings-container">
    
    <h1 class="bookings-header">üìã My Bookings</h1>

    @if (TempData["Message"] != null)
    {
        <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            @TempData["Message"]
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            @TempData["Error"]
        </div>
    }

    @if (ViewBag.PendingCount != null && ViewBag.PendingCount > 0)
    {
        <div class="alert-pending">
            ‚ö†Ô∏è You have @ViewBag.PendingCount booking(s) pending payment. Click üí≥ to complete payment.
        </div>
    }

    @if (Model.Count == 0)
    {
        <div class="no-bookings">
            <div style="font-size: 60px; margin-bottom: 20px;">üé´</div>
            <p>You don't have any bookings yet.</p>
            <p><a href="/Trips" style="color: #007bff; font-weight: 600;">Explore our amazing trips!</a></p>
        </div>
    }
    else
    {
        <div class="bookings-grid">
            @foreach (var booking in Model)
            {
                var trip = booking.Trip;
                
                var statusClass = booking.Status.ToLower() switch
                {
                    "booked" => "booking-card",
                    "cancelled" => "booking-card cancelled",
                    "pendingpayment" => "booking-card pending",
                    _ => "booking-card pending"
                };
                
                var statusBadgeClass = booking.Status.ToLower() switch
                {
                    "booked" => "status-badge status-booked",
                    "cancelled" => "status-badge status-cancelled",
                    "pendingpayment" => "status-badge status-pending",
                    _ => "status-badge status-pending"
                };

                var statusText = booking.Status.ToLower() switch
                {
                    "booked" => "Booked",
                    "cancelled" => "Cancelled",
                    "pendingpayment" => "Pending Payment",
                    _ => booking.Status
                };

                <div class="@statusClass">
                    
                    <div class="@statusBadgeClass">@statusText</div>
                    
                    @if (trip != null)
                    {
                        if (!string.IsNullOrEmpty(trip.ImagePath))
                        {
                            <img src="@trip.ImagePath" alt="@trip.PackageName" class="booking-image" />
                        }
                        else
                        {
                            <div class="booking-image-placeholder">üåç</div>
                        }
                    }

                    <div class="booking-content">
                        
                        @if (trip != null)
                        {
                            <h3 class="booking-title">@trip.PackageName</h3>
                            <p class="booking-id">Booking #@booking.BookingId ‚Ä¢ @trip.Destination, @trip.Country</p>
                        }
                        else
                        {
                            <h3 class="booking-title">Booking #@booking.BookingId</h3>
                            <p class="booking-id">Trip ID: @booking.TripId</p>
                        }

                        <div class="booking-info">
                            @if (trip != null)
                            {
                                <div class="booking-info-row">
                                    <span class="booking-info-label">üìÖ Travel Date</span>
                                    <span class="booking-info-value">@trip.StartDate.ToString("MMM dd, yyyy")</span>
                                </div>
                            }
                            <div class="booking-info-row">
                                <span class="booking-info-label">üóìÔ∏è Booked On</span>
                                <span class="booking-info-value">@booking.BookingDate.ToString("MMM dd, yyyy")</span>
                            </div>
                            <div class="booking-info-row">
                                <span class="booking-info-label">üë• People</span>
                                <span class="booking-info-value">@booking.NumberOfPeople</span>
                            </div>
                            <div class="booking-info-row">
                                <span class="booking-info-label">üí∞ Total Price</span>
                                <span class="booking-info-value">$@booking.TotalPrice</span>
                            </div>
                        </div>

                        <div class="booking-actions">
                            
                            <a href="/Trips/Details/@booking.TripId" class="btn-booking" data-tooltip="View Trip">
                                üó∫Ô∏è
                            </a>

                            @if (booking.Status == "Booked")
                            {
                                <a href="/MyBookings/DownloadItinerary?bookingId=@booking.BookingId" class="btn-booking" data-tooltip="Download PDF">
                                    üìÑ
                                </a>
                            }
                            else if (booking.Status == "PendingPayment")
                            {
                                <a href="/Payments/Pay?bookingId=@booking.BookingId" class="btn-booking" data-tooltip="Pay Now" style="background: #28a745; color: white; border-color: #28a745;">
                                    üí≥
                                </a>
                            }
                            else
                            {
                                <button type="button" class="btn-booking" disabled data-tooltip="PDF Not Available">
                                    üìÑ
                                </button>
                            }

                            @if (booking.Status == "PendingPayment")
                            {
                                <button type="button" onclick="cancelBooking(@booking.BookingId)" class="btn-booking" data-tooltip="Cancel Booking">
                                    ‚ùå
                                </button>
                            }
                            else if (booking.Status != "Cancelled")
                            {
                                <button type="button" onclick="cancelBooking(@booking.BookingId)" class="btn-booking" data-tooltip="Cancel Booking">
                                    ‚ùå
                                </button>
                            }
                            else
                            {
                                <button type="button" class="btn-booking" disabled data-tooltip="Already Cancelled">
                                    ‚ùå
                                </button>
                            }

                            <a href="/Trips" class="btn-booking" data-tooltip="Book Another">
                                ‚ûï
                            </a>
                        </div>

                    </div>
                </div>
            }
        </div>
    }

</div>

<p style="text-align: center; margin-top: 30px;">
    <a href="/Trips" style="color: #007bff; font-weight: 600; font-size: 16px;">‚Üê Back to Trips</a>
</p>

<script>
    function cancelBooking(bookingId) {
        if (!confirm('Are you sure you want to cancel this booking?')) return;
        
        const form = document.createElement('form');
        form.method = 'post';
        form.action = '/MyBookings/Cancel';
        
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'bookingId';
        input.value = bookingId;
        
        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
    }
</script>